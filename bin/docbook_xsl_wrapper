#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path(File.dirname(__FILE__) + '/../lib')

require 'fileutils'
require 'tmpdir'
require 'docbook_xsl_wrapper'


options = DocbookXslWrapper::Options.parse(ARGV)

options.docbooks.each {|docbook_file|
  dir = File.expand_path(File.join(Dir.tmpdir, ".epubtmp#{Time.now.to_f.to_s}"))
  FileUtils.mkdir_p(dir)
  e = DocbookXslWrapper::Epub.new(docbook_file, dir, options.css, options.customization, options.fonts)

  if options.output
    epub_file = options.output
  else
    epub_file = File.join(File.dirname(docbook_file), File.basename(docbook_file, ".xml") + ".epub")
  end
  puts "Rendering DocBook file #{docbook_file} to #{epub_file}" if options.verbose
  e.render_to_file(epub_file)
}
