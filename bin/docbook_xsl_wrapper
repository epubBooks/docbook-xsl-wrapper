#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path(File.dirname(__FILE__) + '/../lib')

require 'tmpdir'
require 'docbook_xsl_wrapper'


options = DocbookXslWrapper::Options.parse(ARGV)

unless File.exist?(options.docbook)
  raise ArgumentError.new("File #{options.docbook} does not exist")
end

options = options
tmp_dir = Dir.mktmpdir

begin
  epub = DocbookXslWrapper::Epub.new(options: options, destination: tmp_dir)
  epub_file = options.output

  puts "Rendering DocBook file #{options.docbook} to #{epub_file}" if options.verbose

  epub.render_to_file(epub_file)
ensure
  FileUtils.remove_entry_secure tmp_dir
end
