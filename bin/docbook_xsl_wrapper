#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path(File.dirname(__FILE__) + '/../lib')

require 'tmpdir'
require 'docbook_xsl_wrapper'


options = DocbookXslWrapper::Options.parse(ARGV)

unless File.exist?(options.docbook)
  raise ArgumentError.new("File #{options.docbook} does not exist")
end

tmp_dir = Dir.mktmpdir
options.destination = tmp_dir

begin
  puts "Rendering DocBook file #{options.docbook} to #{options.output}\n\n" if options.verbose

  epub = DocbookXslWrapper::Epub.new(options)
  epub.render_to_file
ensure
  FileUtils.remove_entry_secure tmp_dir
end
